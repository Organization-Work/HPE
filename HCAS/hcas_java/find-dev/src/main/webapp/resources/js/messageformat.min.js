(function(a){function b(a,c){var d;if(a&&c){b.locale[a]=c}d=a=a||"en";c=c||b.locale[d=b.Utils.getFallbackLocale(a)];if(!c){throw new Error("Plural Function not found for locale: "+a)}this.pluralFunc=c;this.locale=a;this.fallbackLocale=d}b.locale={en:function(a){if(a===1){return"one"}return"other"}};b.SafeString=function(a){this.string=a};b.SafeString.prototype.toString=function(){return this.string.toString()};b.Utils={numSub:function(a,b,c){return a.replace(/^#|[^\\]#/g,function(a){var d=a&&a.length===2?a.charAt(0):"";return d+'" + (function(){ var x = '+b+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+c+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(a){var c={"\n":"\\n",'"':'\\"'},d=/[\n"]/g,e=/[\n"]/,f=function(a){return c[a]||"&"};if(a instanceof b.SafeString){return a.toString()}else if(a===null||a===false){return""}if(!e.test(a)){return a}return a.replace(d,f)},getFallbackLocale:function(a){var c=a.indexOf("-")>=0?"-":"_";while(!b.locale.hasOwnProperty(a)){a=a.substring(0,a.lastIndexOf(c));if(a.length===0){return null}}return a}};var c=function(){var a={parse:function(a,b){function i(a,b,c){var d=a;var e=c-a.length;for(var f=0;f<e;f++){d=b+d}return d}function j(a){var b=a.charCodeAt(0);if(b<=255){var c="x";var d=2}else{var c="u";var d=4}return"\\"+c+i(b.toString(16).toUpperCase(),"0",d)}function k(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,j)+'"'}function l(a){if(d<f){return}if(d>f){f=d;g=[]}g.push(a)}function m(){var a="start@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=n();var f=e!==null?function(a){return{type:"program",program:a}}(e):null;if(f!==null){var g=f}else{var g=null;d=c}h[a]={nextPos:d,result:g};return g}function n(){var a="messageFormatPattern@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=d;var f=y();if(f!==null){var g=[];var i=o();while(i!==null){g.push(i);var i=o()}if(g!==null){var j=[f,g]}else{var j=null;d=e}}else{var j=null;d=e}var k=j!==null?function(a,b){var c=[];if(a&&a.val){c.push(a)}for(var d in b){if(b.hasOwnProperty(d)){c.push(b[d])}}return{type:"messageFormatPattern",statements:c}}(j[0],j[1]):null;if(k!==null){var l=k}else{var l=null;d=c}h[a]={nextPos:d,result:l};return l}function o(){var b="messageFormatPatternRight@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;var g=d;if(a.substr(d,1)==="{"){var i="{";d+=1}else{var i=null;if(e){l('"{"')}}if(i!==null){var j=E();if(j!==null){var k=p();if(k!==null){var m=E();if(m!==null){if(a.substr(d,1)==="}"){var n="}";d+=1}else{var n=null;if(e){l('"}"')}}if(n!==null){var o=y();if(o!==null){var q=[i,j,k,m,n,o]}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}var r=q!==null?function(a,b){var c=[];if(a){c.push(a)}if(b&&b.val){c.push(b)}return{type:"messageFormatPatternRight",statements:c}}(q[2],q[5]):null;if(r!==null){var s=r}else{var s=null;d=f}h[b]={nextPos:d,result:s};return s}function p(){var b="messageFormatElement@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;var g=d;var i=z();if(i!==null){var j=d;if(a.substr(d,1)===","){var k=",";d+=1}else{var k=null;if(e){l('","')}}if(k!==null){var m=q();if(m!==null){var n=[k,m]}else{var n=null;d=j}}else{var n=null;d=j}var o=n!==null?n:"";if(o!==null){var p=[i,o]}else{var p=null;d=g}}else{var p=null;d=g}var r=p!==null?function(a,b){var c={type:"messageFormatElement",argumentIndex:a};if(b&&b.length){c.elementFormat=b[1]}else{c.output=true}return c}(p[0],p[1]):null;if(r!==null){var s=r}else{var s=null;d=f}h[b]={nextPos:d,result:s};return s}function q(){var b="elementFormat@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;var g=d;var i=E();if(i!==null){if(a.substr(d,6)==="plural"){var j="plural";d+=6}else{var j=null;if(e){l('"plural"')}}if(j!==null){var k=E();if(k!==null){if(a.substr(d,1)===","){var m=",";d+=1}else{var m=null;if(e){l('","')}}if(m!==null){var n=E();if(n!==null){var o=r();if(o!==null){var p=E();if(p!==null){var q=[i,j,k,m,n,o,p]}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}var t=q!==null?function(a,b){return{type:"elementFormat",key:a,val:b.val}}(q[1],q[5]):null;if(t!==null){var u=t}else{var u=null;d=f}if(u!==null){var v=u}else{var w=d;var x=d;var y=E();if(y!==null){if(a.substr(d,6)==="select"){var z="select";d+=6}else{var z=null;if(e){l('"select"')}}if(z!==null){var A=E();if(A!==null){if(a.substr(d,1)===","){var B=",";d+=1}else{var B=null;if(e){l('","')}}if(B!==null){var C=E();if(C!==null){var D=s();if(D!==null){var F=E();if(F!==null){var G=[y,z,A,B,C,D,F]}else{var G=null;d=x}}else{var G=null;d=x}}else{var G=null;d=x}}else{var G=null;d=x}}else{var G=null;d=x}}else{var G=null;d=x}}else{var G=null;d=x}var H=G!==null?function(a,b){return{type:"elementFormat",key:a,val:b.val}}(G[1],G[5]):null;if(H!==null){var I=H}else{var I=null;d=w}if(I!==null){var v=I}else{var v=null;}}h[b]={nextPos:d,result:v};return v}function r(){var a="pluralStyle@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=t();var f=e!==null?function(a){return{type:"pluralStyle",val:a}}(e):null;if(f!==null){var g=f}else{var g=null;d=c}h[a]={nextPos:d,result:g};return g}function s(){var a="selectStyle@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=v();var f=e!==null?function(a){return{type:"selectStyle",val:a}}(e):null;if(f!==null){var g=f}else{var g=null;d=c}h[a]={nextPos:d,result:g};return g}function t(){var a="pluralFormatPattern@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=d;var f=u();var g=f!==null?f:"";if(g!==null){var i=[];var j=w();while(j!==null){i.push(j);var j=w()}if(i!==null){var k=[g,i]}else{var k=null;d=e}}else{var k=null;d=e}var l=k!==null?function(a,b){var c={type:"pluralFormatPattern",pluralForms:b};if(a){c.offset=a}else{c.offset=0}return c}(k[0],k[1]):null;if(l!==null){var m=l}else{var m=null;d=c}h[a]={nextPos:d,result:m};return m}function u(){var b="offsetPattern@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;var g=d;var i=E();if(i!==null){if(a.substr(d,6)==="offset"){var j="offset";d+=6}else{var j=null;if(e){l('"offset"')}}if(j!==null){var k=E();if(k!==null){if(a.substr(d,1)===":"){var m=":";d+=1}else{var m=null;if(e){l('":"')}}if(m!==null){var n=E();if(n!==null){var o=C();if(o!==null){var p=E();if(p!==null){var q=[i,j,k,m,n,o,p]}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}}else{var q=null;d=g}var r=q!==null?function(a){return a}(q[5]):null;if(r!==null){var s=r}else{var s=null;d=f}h[b]={nextPos:d,result:s};return s}function v(){var a="selectFormatPattern@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=[];var f=w();while(f!==null){e.push(f);var f=w()}var g=e!==null?function(a){return{type:"selectFormatPattern",pluralForms:a}}(e):null;if(g!==null){var i=g}else{var i=null;d=c}h[a]={nextPos:d,result:i};return i}function w(){var b="pluralForms@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;var g=d;var i=E();if(i!==null){var j=x();if(j!==null){var k=E();if(k!==null){if(a.substr(d,1)==="{"){var m="{";d+=1}else{var m=null;if(e){l('"{"')}}if(m!==null){var o=E();if(o!==null){var p=n();if(p!==null){var q=E();if(q!==null){if(a.substr(d,1)==="}"){var r="}";d+=1}else{var r=null;if(e){l('"}"')}}if(r!==null){var s=[i,j,k,m,o,p,q,r]}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}var t=s!==null?function(a,b){return{type:"pluralForms",key:a,val:b}}(s[1],s[5]):null;if(t!==null){var u=t}else{var u=null;d=f}h[b]={nextPos:d,result:u};return u}function x(){var b="stringKey@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;var g=z();var i=g!==null?function(a){return a}(g):null;if(i!==null){var j=i}else{var j=null;d=f}if(j!==null){var k=j}else{var m=d;var n=d;if(a.substr(d,1)==="="){var o="=";d+=1}else{var o=null;if(e){l('"="')}}if(o!==null){var p=C();if(p!==null){var q=[o,p]}else{var q=null;d=n}}else{var q=null;d=n}var r=q!==null?function(a){return a}(q[1]):null;if(r!==null){var s=r}else{var s=null;d=m}if(s!==null){var k=s}else{var k=null;}}h[b]={nextPos:d,result:k};return k}function y(){var a="string@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=d;var f=E();if(f!==null){var g=[];var i=d;var j=E();if(j!==null){var k=A();if(k!==null){var l=E();if(l!==null){var m=[j,k,l]}else{var m=null;d=i}}else{var m=null;d=i}}else{var m=null;d=i}while(m!==null){g.push(m);var i=d;var j=E();if(j!==null){var k=A();if(k!==null){var l=E();if(l!==null){var m=[j,k,l]}else{var m=null;d=i}}else{var m=null;d=i}}else{var m=null;d=i}}if(g!==null){var n=[f,g]}else{var n=null;d=e}}else{var n=null;d=e}var o=n!==null?function(a,b){var c=[];for(var d=0;d<b.length;++d){for(var e=0;e<b[d].length;++e){c.push(b[d][e])}}return{type:"string",val:a+c.join("")}}(n[0],n[1]):null;if(o!==null){var p=o}else{var p=null;d=c}h[a]={nextPos:d,result:p};return p}function z(){var b="id@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;var g=d;var i=E();if(i!==null){if(a.substr(d).match(/^[a-zA-Z$_]/)!==null){var j=a.charAt(d);d++}else{var j=null;if(e){l("[a-zA-Z$_]")}}if(j!==null){var k=[];if(a.substr(d).match(/^[^ 	\n\r,.+={}]/)!==null){var m=a.charAt(d);d++}else{var m=null;if(e){l("[^ 	\\n\\r,.+={}]")}}while(m!==null){k.push(m);if(a.substr(d).match(/^[^ 	\n\r,.+={}]/)!==null){var m=a.charAt(d);d++}else{var m=null;if(e){l("[^ 	\\n\\r,.+={}]")}}}if(k!==null){var n=E();if(n!==null){var o=[i,j,k,n]}else{var o=null;d=g}}else{var o=null;d=g}}else{var o=null;d=g}}else{var o=null;d=g}var p=o!==null?function(a,b){return a+(b?b.join(""):"")}(o[1],o[2]):null;if(p!==null){var q=p}else{var q=null;d=f}h[b]={nextPos:d,result:q};return q}function A(){var a="chars@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=d;var e=B();if(e!==null){var f=[];while(e!==null){f.push(e);var e=B()}}else{var f=null}var g=f!==null?function(a){return a.join("")}(f):null;if(g!==null){var i=g}else{var i=null;d=c}h[a]={nextPos:d,result:i};return i}function B(){var b="char@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;if(a.substr(d).match(/^[^{}\\\0- 	\n\r]/)!==null){var g=a.charAt(d);d++}else{var g=null;if(e){l("[^{}\\\\\\0- 	\\n\\r]")}}var i=g!==null?function(a){return a}(g):null;if(i!==null){var j=i}else{var j=null;d=f}if(j!==null){var k=j}else{var m=d;if(a.substr(d,2)==="\\#"){var n="\\#";d+=2}else{var n=null;if(e){l('"\\\\#"')}}var o=n!==null?function(){return"\\#"}():null;if(o!==null){var p=o}else{var p=null;d=m}if(p!==null){var k=p}else{var q=d;if(a.substr(d,2)==="\\{"){var r="\\{";d+=2}else{var r=null;if(e){l('"\\\\{"')}}var s=r!==null?function(){return"{"}():null;if(s!==null){var t=s}else{var t=null;d=q}if(t!==null){var k=t}else{var u=d;if(a.substr(d,2)==="\\}"){var v="\\}";d+=2}else{var v=null;if(e){l('"\\\\}"')}}var w=v!==null?function(){return"}"}():null;if(w!==null){var x=w}else{var x=null;d=u}if(x!==null){var k=x}else{var y=d;var z=d;if(a.substr(d,2)==="\\u"){var A="\\u";d+=2}else{var A=null;if(e){l('"\\\\u"')}}if(A!==null){var B=D();if(B!==null){var C=D();if(C!==null){var E=D();if(E!==null){var F=D();if(F!==null){var G=[A,B,C,E,F]}else{var G=null;d=z}}else{var G=null;d=z}}else{var G=null;d=z}}else{var G=null;d=z}}else{var G=null;d=z}var H=G!==null?function(a,b,c,d){return String.fromCharCode(parseInt("0x"+a+b+c+d))}(G[1],G[2],G[3],G[4]):null;if(H!==null){var I=H}else{var I=null;d=y}if(I!==null){var k=I}else{var k=null;}}}}}h[b]={nextPos:d,result:k};return k}function C(){var b="digits@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}var f=d;if(a.substr(d).match(/^[0-9]/)!==null){var g=a.charAt(d);d++}else{var g=null;if(e){l("[0-9]")}}if(g!==null){var i=[];while(g!==null){i.push(g);if(a.substr(d).match(/^[0-9]/)!==null){var g=a.charAt(d);d++}else{var g=null;if(e){l("[0-9]")}}}}else{var i=null}var j=i!==null?function(a){return parseInt(a.join(""),10)}(i):null;if(j!==null){var k=j}else{var k=null;d=f}h[b]={nextPos:d,result:k};return k}function D(){var b="hexDigit@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}if(a.substr(d).match(/^[0-9a-fA-F]/)!==null){var f=a.charAt(d);d++}else{var f=null;if(e){l("[0-9a-fA-F]")}}h[b]={nextPos:d,result:f};return f}function E(){var a="_@"+d;var b=h[a];if(b){d=b.nextPos;return b.result}var c=e;e=false;var f=d;var g=[];var i=F();while(i!==null){g.push(i);var i=F()}var j=g!==null?function(a){return a.join("")}(g):null;if(j!==null){var k=j}else{var k=null;d=f}e=c;if(e&&k===null){l("whitespace")}h[a]={nextPos:d,result:k};return k}function F(){var b="whitespace@"+d;var c=h[b];if(c){d=c.nextPos;return c.result}if(a.substr(d).match(/^[ 	\n\r]/)!==null){var f=a.charAt(d);d++}else{var f=null;if(e){l("[ 	\\n\\r]")}}h[b]={nextPos:d,result:f};return f}function G(){function b(a){a.sort();var b=null;var c=[];for(var d=0;d<a.length;d++){if(a[d]!==b){c.push(a[d]);b=a[d]}}switch(c.length){case 0:return"end of input";case 1:return c[0];default:return c.slice(0,c.length-1).join(", ")+" or "+c[c.length-1]}}var c=b(g);var e=Math.max(d,f);var h=e<a.length?k(a.charAt(e)):"end of input";return"Expected "+c+" but "+h+" found."}function H(){var b=1;var c=1;var d=false;for(var e=0;e<f;e++){var g=a.charAt(e);if(g==="\n"){if(!d){b++}c=1;d=false}else if(g==="\r"|g==="\u2028"||g==="\u2029"){b++;c=1;d=true}else{c++;d=false}}return{line:b,column:c}}var c={_:E,"char":B,chars:A,digits:C,elementFormat:q,hexDigit:D,id:z,messageFormatElement:p,messageFormatPattern:n,messageFormatPatternRight:o,offsetPattern:u,pluralFormatPattern:t,pluralForms:w,pluralStyle:r,selectFormatPattern:v,selectStyle:s,start:m,string:y,stringKey:x,whitespace:F};if(b!==undefined){if(c[b]===undefined){throw new Error("Invalid rule name: "+k(b)+".")}}else{b="start"}var d=0;var e=true;var f=0;var g=[];var h={};var I=c[b]();if(I===null||d!==a.length){var J=H();throw new this.SyntaxError(G(),J.line,J.column)}return I},toSource:function(){return this._source}};a.SyntaxError=function(a,b,c){this.name="SyntaxError";this.message=a;this.line=b;this.column=c};a.SyntaxError.prototype=Error.prototype;return a}();b.prototype.parse=function(){return c.parse.apply(c,arguments)};b.prototype.precompile=function(a){function f(a,g){g=g||{};var h="",i,j,k;switch(a.type){case"program":return f(a.program);case"messageFormatPattern":for(i=0;i<a.statements.length;++i){h+=f(a.statements[i],g)}return e.begin+h+e.end;case"messageFormatPatternRight":for(i=0;i<a.statements.length;++i){h+=f(a.statements[i],g)}return h;case"messageFormatElement":g.pf_count=g.pf_count||0;h+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n';if(a.output){h+='r += d["'+a.argumentIndex+'"];\n'}else{k="lastkey_"+(g.pf_count+1);h+="var "+k+' = "'+a.argumentIndex+'";\n';h+="var k_"+(g.pf_count+1)+"=d["+k+"];\n";h+=f(a.elementFormat,g)}return h;case"elementFormat":if(a.key==="select"){h+=f(a.val,g);h+="r += (pf_"+g.pf_count+"[ k_"+(g.pf_count+1)+" ] || pf_"+g.pf_count+'[ "other" ])( d );\n'}else if(a.key==="plural"){h+=f(a.val,g);h+="if ( pf_"+g.pf_count+"[ k_"+(g.pf_count+1)+' + "" ] ) {\n';h+="r += pf_"+g.pf_count+"[ k_"+(g.pf_count+1)+' + "" ]( d ); \n';h+="}\nelse {\n";h+="r += (pf_"+g.pf_count+'[ MessageFormat.locale["'+c.fallbackLocale+'"]( k_'+(g.pf_count+1)+" - off_"+g.pf_count+" ) ] || pf_"+g.pf_count+'[ "other" ] )( d );\n';h+="}\n"}return h;case"pluralFormatPattern":g.pf_count=g.pf_count||0;h+="var off_"+g.pf_count+" = "+a.offset+";\n";h+="var pf_"+g.pf_count+" = { \n";d=true;for(i=0;i<a.pluralForms.length;++i){if(a.pluralForms[i].key==="other"){d=false}if(j){h+=",\n"}else{j=1}h+='"'+a.pluralForms[i].key+'" : '+f(a.pluralForms[i].val,function(){var a=JSON.parse(JSON.stringify(g));a.pf_count++;return a}())}h+="\n};\n";if(d){throw new Error("No 'other' form found in pluralFormatPattern "+g.pf_count)}return h;case"selectFormatPattern":g.pf_count=g.pf_count||0;h+="var off_"+g.pf_count+" = 0;\n";h+="var pf_"+g.pf_count+" = { \n";d=true;for(i=0;i<a.pluralForms.length;++i){if(a.pluralForms[i].key==="other"){d=false}if(j){h+=",\n"}else{j=1}h+='"'+a.pluralForms[i].key+'" : '+f(a.pluralForms[i].val,function(){var a=JSON.parse(JSON.stringify(g));a.pf_count++;return a}())}h+="\n};\n";if(d){throw new Error("No 'other' form found in selectFormatPattern "+g.pf_count)}return h;case"string":return'r += "'+b.Utils.numSub(b.Utils.escapeExpression(a.val),"k_"+g.pf_count+" - off_"+(g.pf_count-1),g.pf_count)+'";\n';default:throw new Error("Bad AST type: "+a.type)}}var c=this,d=false,e={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};return f(a)};b.prototype.compile=function(a){return(new Function("MessageFormat","return "+this.precompile(this.parse(a))))(b)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.MessageFormat=b}else if(typeof define==="function"&&define.amd){define(function(){return b})}else{a["MessageFormat"]=b}})(this)
